/**
 * jqQuiz plugin v0.0.0 | Davinchi | https://github.com/davinchi-finsi/jq-quiz/blob/master/LICENSE
 */

!function(t,e){"function"==typeof define&&define.amd?define(["exports","jquery","svg.js","jquery-ui","tooltipster"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("jquery"),require("svg.js"),require("jquery-ui"),require("tooltipster")):e(t.jqTooltipsteredImage={},t.$,t.SVG)}(this,function(t,e,i){e.widget("jqtlpi.tooltipsteredImageStep",{ON_COMPLETED:"tooltipsteredImageStep:completed",STATES:{waiting:0,current:1,active:2,completed:3},options:{classes:{main:"tooltipstered-image__step",waiting:"tooltipstered-image__step--waiting",current:"tooltipstered-image__step--current",active:"tooltipstered-image__step--active",completed:"tooltipstered-image__step--completed",disabled:"tooltipstered-image__step--disabled"},tooltip:{},enableTooltip:null,disableTooltip:null,processTitle:null,processTemplate:null,destroyTooltip:null,registerTooltipEvents:null,initTooltip:null},_create:function(){this.refresh(),this._registerTooltipEvents()},_setStateWaiting:function(){this._currentState=this.STATES.waiting,this.element.removeClass(this.options.classes.current),this.element.removeClass(this.options.classes.active),this.element.addClass(this.options.classes.waiting),this._disableTooltip()},_setStateCurrent:function(){this._currentState===this.STATES.waiting&&(this._currentState=this.STATES.current,this.element.removeClass(this.options.classes.waiting),this.element.addClass(this.options.classes.current),this._enableTooltip())},_setStateActive:function(){this._currentState===this.STATES.current&&(this._currentState=this.STATES.active,this.element.removeClass(this.options.classes.current),this.element.addClass(this.options.classes.active))},_setStateCompleted:function(){this._currentState===this.STATES.active&&(this._currentState=this.STATES.completed,this.element.removeClass(this.options.classes.active),this.element.addClass(this.options.classes.completed))},_setState:function(t){switch(t){case this.STATES.waiting:this._setStateWaiting();break;case this.STATES.current:this._setStateCurrent();break;case this.STATES.active:this._setStateActive();break;case this.STATES.completed:this._setStateCompleted()}},refresh:function(){this._destroyTooltip(),this._processTitle(),this._processTemplate(),this._initTooltip(this.options.tooltip),this._setState(this.STATES.waiting)},run:function(){this._setState(this.STATES.current)},reset:function(){this._setState(this.STATES.waiting)},_processTitle:function(){"function"==(typeof this.options.processTitle).toLowerCase()?this.options.processTitle.call(this):void 0!=this.options.title&&this.element.attr("title",this.options.title)},_processTemplate:function(){"function"==(typeof this.options.processTemplate).toLowerCase()?void 0!=this.options.template&&this.options.processTemplate.call(this,this.options.template):void 0!=this.options.template&&this.element.attr("data-tooltip-content",this.options.template)},_destroyTooltip:function(){"function"==(typeof this.options.destroyTooltip).toLowerCase()?this.options.destroyTooltip.call(this):this.element.data("tooltipsterNs")&&this.element.data(this.element.data("tooltipsterNs")[0]).destroy()},_initTooltip:function(t){if("function"==(typeof this.options.initTooltip).toLowerCase()){if("function"!=(typeof this.options.registerTooltipEvents).toLowerCase())throw"TooltipsteredImageStepError: If initTooltip option is provided, registerTooltipEvents must be provided as well";if("function"!=(typeof this.options.enableTooltip).toLowerCase())throw"TooltipsteredImageStepError: If initTooltip option is provided, enableTooltip must be provided as well";if("function"!=(typeof this.options.disableTooltip).toLowerCase())throw"TooltipsteredImageStepError: If initTooltip option is provided, disableTooltip must be provided as well";this.options.initTooltip.call(this,t)}else this.element.tooltipster(t)},_registerTooltipEvents:function(){if("function"==(typeof this.options.registerTooltipEvents).toLowerCase())this.options.registerTooltipEvents.call(this,this._onTooltipOpening.bind(this),this._onTooltipClose.bind(this));else{var t=this.element.data(this.element.data("tooltipsterNs")[0]);t.on("startend",this._onTooltipOpening.bind(this)),t.on("closing",this._onTooltipClose.bind(this))}},_enableTooltip:function(){"function"==(typeof this.options.enableTooltip).toLowerCase()?this.options.enableTooltip.call(this):this.element.tooltipster("enable")},_disableTooltip:function(){"function"==(typeof this.options.disableTooltip).toLowerCase()?this.options.disableTooltip.call(this):this.element.tooltipster("disable")},_onTooltipOpening:function(){1!=this.options.disabled&&this._setState(this.STATES.active)},_onTooltipClose:function(){1!=this.options.disabled&&this._currentState!=this.STATES.completed&&(this._setState(this.STATES.completed),this.element.trigger(this.ON_COMPLETED))},enable:function(){this.options.disabled=!1,this.element.removeClass(this.options.classes.disabled),this._currentState!=this.STATES.waiting&&this._enableTooltip()},disable:function(){this.options.disabled=!0,this.element.addClass(this.options.classes.disabled),this._disableTooltip()}}),e.widget("ui.tooltipsteredImage",{ON_COMPLETED:"tooltipsteredImage:completed",options:{classes:{main:"tooltipstered-image",waiting:"tooltipstered-image--running",completed:"tooltipstered-image--completed"},svgUrl:"",viewbox:[0,0,100,100],svgAttr:{preserveAspectRatio:"xMidYMid meet"},autoRun:!0,autoStop:!1,initialized:null},_create:function(){this._completed=0,this.element.addClass(this.options.classes.main),this.refresh()},refresh:function(){this._clear(),this._initSvg()},_clear:function(){this._svgContext&&this.element.find("#"+this._svgContext.id()).remove()},_applySvgAttrs:function(t){this._svgContext&&this._svgContext.attr(t)},_applySvgViewbox:function(t){this._svgContext&&(Array.isArray(t)?this._svgContext.viewbox.apply(this._svgContext,t):this._svgContext.viewbox(t))},_initSvg:function(){var t=e.Deferred();return this._svgContext=i(this.element.get(0)).size("100%","100%"),this.options.viewbox&&(this._applySvgViewbox(this.options.viewbox),this._applySvgAttrs(this.options.svgAttr),this._loadSvgFile().then(this._onProcessedSvgFile.bind(this,t))),t.promise()},_onProcessedSvgFile:function(t,e){this._svgContext.svg(e),this._processSvgElements(),"function"==(typeof this.options.initialized).toLowerCase()&&this.options.initialized(this),1==this.options.autoRun&&this.run(),t.resolve()},_processSvgFile:function(t){return(new XMLSerializer).serializeToString(t)},_onGetSvgFileSuccess:function(t){var e=this,i=e._data.context,s=e._data.defer,o=i._processSvgFile(t.documentElement);s.resolveWith(i,[o])},_onGetSvgFileFail:function(t){throw console.error("TooltipsteredImageError: The svg file could not be loaded"),t},_loadSvgFile:function(){var t=e.Deferred();return e.ajax({method:"GET",type:"document",url:this.options.svgUrl,_data:{context:this,defer:t}}).then(this._onGetSvgFileSuccess,this._onGetSvgFileFail),t.promise()},_processSvgElement:function(t){var s=i.get(t.id);if(void 0!=s){e(s.node).tooltipsteredImageStep(e.extend({svg:s},t));var o=e(s.node),n={$svg:o,stepInstance:o.tooltipsteredImageStep("instance"),svg:s,options:t};return o.off("tooltipsteredImageStep:completed"),o.on("tooltipsteredImageStep:completed",{instance:this},this._onStepCompleted),n}},_processSvgElements:function(){if(this._svgContext){this._steps=[];for(var t=this.options.items,e=0,i=t.length;e<i;e++){var s=t[e],o=this._processSvgElement(s);void 0!=o&&this._steps.push(o)}}},_onStepCompleted:function(t){var e=t.data.instance;e._completed++,e._checkCompleted()},_checkCompleted:function(){this._completed==this._steps.length&&(1==this.options.autoStop&&this.stop(),this.element.addClass(this.options.classes.completed),this.element.trigger(this.ON_COMPLETED))},stop:function(){if(this._running){this._running=!1;for(var t=0,e=this._steps;t<e.length;t++)e[t].stepInstance.disable();this.element.removeClass(this.options.classes.running)}},reset:function(){if(!this._running){this._completed=0;for(var t=0,e=this._steps;t<e.length;t++)e[t].stepInstance.reset()}},run:function(){if(1!=this.options.disabled&&(this._running=!0,this.element.addClass(this.options.classes.running),0==this._completed))if(this.options.sequential)this._steps.length>0&&this._steps[0].stepInstance.run();else for(var t=0,e=this._steps;t<e.length;t++)e[t].stepInstance.run()},setOption:function(t,e){switch(this._super(t,e),t){case"viewbox":this._applySvgViewbox(e);break;case"svgAttr":this._applySvgAttrs(e)}}})});