/**
 * jqQuiz plugin v0.1.4 | Davinchi | https://github.com/davinchi-finsi/jq-quiz/blob/master/LICENSE
 */

!function(t,e){"function"==typeof define&&define.amd?define(["exports","jquery","svg.js","jquery-ui","tooltipster"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("jquery"),require("svg.js"),require("jquery-ui"),require("tooltipster")):e(t.jqTooltipsteredImage={},t.$,t.SVG)}(this,function(t,n,l){n.widget("jqtlpi.tooltipsteredImageStep",{ON_COMPLETED:"tooltipsteredImageStep:completed",STATES:{waiting:0,current:1,active:2,completed:3,open:4},options:{classes:{main:"tooltipstered-image__step",waiting:"tooltipstered-image__step--waiting",current:"tooltipstered-image__step--current",active:"tooltipstered-image__step--active",completed:"tooltipstered-image__step--completed",disabled:"tooltipstered-image__step--disabled",open:"tooltipstered-image__step--open"},tooltip:{},enableTooltip:null,disableTooltip:null,processTitle:null,processTemplate:null,destroyTooltip:null,registerTooltipEvents:null,initTooltip:null},_create:function(){this.refresh(),this.element.addClass(this.options.classes.main),this._registerTooltipEvents()},_setStateWaiting:function(){this._currentState=this.STATES.waiting,this.element.removeClass(this.options.classes.current),this.element.removeClass(this.options.classes.active),this.element.addClass(this.options.classes.waiting),this._disableTooltip()},_setStateCurrent:function(){this._currentState===this.STATES.waiting&&(this._currentState=this.STATES.current,this.element.removeClass(this.options.classes.waiting),this.element.addClass(this.options.classes.current),this._enableTooltip())},_setStateActive:function(){this._currentState===this.STATES.current&&(this._currentState=this.STATES.active,this.element.removeClass(this.options.classes.current),this.element.addClass(this.options.classes.active))},_setStateCompleted:function(){this._currentState===this.STATES.active&&(this._currentState=this.STATES.completed,this.element.removeClass(this.options.classes.active),this.element.addClass(this.options.classes.completed))},_setState:function(t){switch(t){case this.STATES.waiting:this._setStateWaiting();break;case this.STATES.current:this._setStateCurrent();break;case this.STATES.active:this._setStateActive();break;case this.STATES.completed:this._setStateCompleted()}},refresh:function(){this._destroyTooltip(),this._processTitle(),this._processTemplate(),this._initTooltip(this.options.tooltip),this._setState(this.STATES.waiting)},run:function(){this._setState(this.STATES.current)},reset:function(){this._setState(this.STATES.waiting)},_processTitle:function(){"function"==(typeof this.options.processTitle).toLowerCase()?this.options.processTitle.call(this):null!=this.options.title&&this.element.attr("title",this.options.title)},_processTemplate:function(){"function"==(typeof this.options.processTemplate).toLowerCase()?null!=this.options.template&&this.options.processTemplate.call(this,this.options.template):null!=this.options.template&&this.element.attr("data-tooltip-content",this.options.template)},_destroyTooltip:function(){"function"==(typeof this.options.destroyTooltip).toLowerCase()?this.options.destroyTooltip.call(this):this.element.data("tooltipsterNs")&&this.element.data(this.element.data("tooltipsterNs")[0]).destroy()},_initTooltip:function(t){if("function"==(typeof this.options.initTooltip).toLowerCase()){if("function"!=(typeof this.options.registerTooltipEvents).toLowerCase())throw"TooltipsteredImageStepError: If initTooltip option is provided, registerTooltipEvents must be provided as well";if("function"!=(typeof this.options.enableTooltip).toLowerCase())throw"TooltipsteredImageStepError: If initTooltip option is provided, enableTooltip must be provided as well";if("function"!=(typeof this.options.disableTooltip).toLowerCase())throw"TooltipsteredImageStepError: If initTooltip option is provided, disableTooltip must be provided as well";this.options.initTooltip.call(this,t)}else this.element.tooltipster(t)},_registerTooltipEvents:function(){"function"==(typeof this.options.registerTooltipEvents).toLowerCase()?this.options.registerTooltipEvents.call(this,this._onTooltipOpening.bind(this),this._onTooltipClose.bind(this)):this.element.data(this.element.data("tooltipsterNs")[0]).on("state",this._onTooltipsterStateChange.bind(this))},_onTooltipsterStateChange:function(t){"appearing"==t.state?this._onTooltipOpening():"closed"==t.state&&this._onTooltipClose()},_enableTooltip:function(){"function"==(typeof this.options.enableTooltip).toLowerCase()?this.options.enableTooltip.call(this):this.element.tooltipster("enable")},_disableTooltip:function(){"function"==(typeof this.options.disableTooltip).toLowerCase()?this.options.disableTooltip.call(this):this.element.tooltipster("disable")},_onTooltipOpening:function(){1!=this.options.disabled&&(this._setState(this.STATES.active),this.element.addClass(this.options.classes.open))},_onTooltipClose:function(){1!=this.options.disabled&&(this.element.removeClass(this.options.classes.open),this._currentState!=this.STATES.completed&&(this._setState(this.STATES.completed),this.element.trigger(this.ON_COMPLETED)))},enable:function(){this.options.disabled=!1,this.element.removeClass(this.options.classes.disabled),this._currentState!=this.STATES.waiting&&this._enableTooltip()},disable:function(){this.options.disabled=!0,this.element.addClass(this.options.classes.disabled),this._disableTooltip()}}),n.widget("ui.tooltipsteredImage",{ON_COMPLETED:"tooltipsteredImage:completed",options:{classes:{main:"tooltipstered-image",waiting:"tooltipstered-image--running",completed:"tooltipstered-image--completed"},svgUrl:"",svgAttr:{preserveAspectRatio:"xMidYMid meet"},autoRun:!0,autoStop:!1,initialized:null},_create:function(){this._completed=0,this.element.addClass(this.options.classes.main),this.refresh()},refresh:function(){this._clear(),this._initSvg()},_clear:function(){this._svgContext&&this.element.find("#"+this._svgContext.id()).remove()},_applySvgAttrs:function(t){this._svgContext&&this._svgContext.attr(t)},_applySvgViewbox:function(t){this._svgContext&&(Array.isArray(t)?this._svgContext.viewbox.apply(this._svgContext,t):this._svgContext.viewbox(t))},_initSvg:function(){var t=n.Deferred();return this._svgContext=l(this.element.get(0)).size("100%","100%"),this.options.viewbox&&this._applySvgViewbox(this.options.viewbox),this.options.svgAttr&&this._applySvgAttrs(this.options.svgAttr),this._loadSvgFile().then(this._onProcessedSvgFile.bind(this,t)),t.promise()},_onProcessedSvgFile:function(t,e){this._svgContext.svg(e),this._processSvgElements(),"function"==(typeof this.options.initialized).toLowerCase()&&this.options.initialized(this),1==this.options.autoRun&&this.run(),t.resolve()},_processSvgFile:function(t){if(t){return t.innerHTML?t.innerHTML:(new XMLSerializer).serializeToString(t).replace(/^<svg[^>]*>/,"").replace(/<\/svg>/,"")}throw"[ERROR] TooltipsteredImageError: The requested file is not valid:"+this.options.svgUrl},_onGetSvgFileSuccess:function(t){var e=this._data.context,s=this._data.defer,i=e._processSvgFile(t.documentElement);s.resolveWith(e,[i])},_onGetSvgFileFail:function(t){throw console.error("[Error] TooltipsteredImageError: The svg file could not be loaded"),t},_loadSvgFile:function(){var t=n.Deferred();return this.options.svgUrl?n.ajax({method:"GET",type:"document",url:this.options.svgUrl,_data:{context:this,defer:t}}).then(this._onGetSvgFileSuccess,this._onGetSvgFileFail):(console.error("[ERROR] TooltipsteredImageError: The svgUrl option is obligatory"),t.reject()),t.promise()},_processSvgElement:function(t){var e=l.get(t.id);if(null!=e){n(e.node).tooltipsteredImageStep(n.extend({svg:e},t));var s=n(e.node),i=s.tooltipsteredImageStep("instance"),o={$svg:s,stepInstance:i,svg:e,options:t};return s.off("tooltipsteredImageStep:completed"),s.on("tooltipsteredImageStep:completed",{instance:this},this._onStepCompleted),o}},_processSvgElements:function(){if(this._svgContext){this._steps=[];for(var t=this.options.items,e=0,s=t.length;e<s;e++){var i=t[e],o=this._processSvgElement(i);null!=o&&this._steps.push(o)}}},_onStepCompleted:function(t){var e=t.data.instance;e._completed++,e._checkCompleted()||e._runNextStep()},_runNextStep:function(){!0===this.options.sequential&&this._steps[this._completed].stepInstance.run()},_checkCompleted:function(){var t=!1;return this._completed==this._steps.length&&(t=!0,1==this.options.autoStop&&this.stop(),this.element.addClass(this.options.classes.completed),this.element.trigger(this.ON_COMPLETED)),t},stop:function(){if(this._running){this._running=!1;for(var t=0,e=this._steps;t<e.length;t++){e[t].stepInstance.disable()}this.element.removeClass(this.options.classes.running)}},reset:function(){if(!this._running)for(var t=this._completed=0,e=this._steps;t<e.length;t++){e[t].stepInstance.reset()}},run:function(){if(1!=this.options.disabled&&(this._running=!0,this.element.addClass(this.options.classes.running),0==this._completed))if(this.options.sequential)0<this._steps.length&&this._steps[0].stepInstance.run();else for(var t=0,e=this._steps;t<e.length;t++){e[t].stepInstance.run()}},setOption:function(t,e){switch(this._super(t,e),t){case"viewbox":this._applySvgViewbox(e);break;case"svgAttr":this._applySvgAttrs(e)}}})});